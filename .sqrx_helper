CHROME_BUILD_PATH=~/Documents/chrome-ext-build
FIREFOX_BUILD_PATH=~/Documents/firefox-ext-build
BUILD_PATH=~/dev/chrome-extension/build
EXT_SRC_PATH=~/dev/chrome-extension

build_ext() {
  local build_opt=$1
  local env_opt=$2

  if [[ ! -d "$EXT_SRC_PATH" ]]; then
    echo "Source path not found ðŸš«: $EXT_SRC_PATH"
    return 1
  fi

  echo "Building extension with options: build_opt=$build_opt, env_opt=$env_opt"

  cd "$EXT_SRC_PATH"
  node ./.artifacts/build.js "$build_opt" "$env_opt"

  echo "Build complete âœ…. Output at $BUILD_PATH"
}

deploy_ext() {
  local target_path=$1
  local src="$BUILD_PATH"

  # sanity checks
  if [[ -z "$target_path" ]]; then
    echo "Failed ðŸš« (empty target path)"; return 1
  fi
  if [[ ! -d "$src" ]]; then
    echo "Failed ðŸš« (build dir not found: $src)"; return 1
  fi
  if [[ "$target_path" == "/" ]]; then
    echo "Failed ðŸš« (refusing to rm '/')"; return 1
  fi

  # deploy
  rm -rf -- "$target_path"
  mkdir -p -- "$target_path"
  cp -a -- "$src"/. "$target_path"/
  echo "Deployed âœ… -> $target_path"
}

alias sxdc='deploy_ext "$CHROME_BUILD_PATH"'
alias sxdf='deploy_ext "$FIREFOX_BUILD_PATH"'
alias sxbdc='build_ext 12 2; sxdc'
alias sxbdf='build_ext 13 2; sxdf'
